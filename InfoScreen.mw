{{ProjektInfoBox
|name        = InfoScreen
|status      = beta
|image       = Infoscreen01.jpg
|description = Aktuelle Information über das RaumZeitLabor
|author      = [[Benutzer:Tiefpunkt|tiefpunkt]], [[Benutzer:Blabber|blabber]], [[Benutzer:Silsha|silsha]]
|username    = 
|version     = v0.4
|update      = 
|platform    = 
|preis       = 
|license     = 
|download    = https://github.com/raumzeitlabor/infoscreen
}}

== Beschreibung ==

Der InfoScreen steht auf dem Kühlschrank und zeigt einige interessante Informationen an. Aktuell sind das:
* Aktueller Stromverbrauch + Graph des Verbrauchs über die letzten 60 Minuten
* Anzahl Geräte im Netzwerk
* Temperatur
* Mitgliederanzahl
* Kontostand
* RaumStatus
* Fahrplan der Bahnhaltestelle Boveristraße
* Twitterwall
* Bilder aus [http://log.raumzeitlabor.de log.raumzeitlabor.de]

== Technik ==

Auf einem Raspberry Pi läuft ein Raspbian, dass beim Hochfahren einen Chromium im Kioskmodus öffnet und auf http://cosm.tiefpunkt.com/infoscreen/ navigiert. Da läuft der Infoscreen, eine Mischung aus PHP, HTML und JS, die aus Daten von Cosm, der VRN und Twitter eine kleine Seite produziert, die alle 30 Sekunden aktualisiert wird.

== Konfiguration ==

=== Software ===

  sudo apt-get install chromium x11-xserver-utils unclutter lighttpd php5-cgi git

  sudo nano /etc/lighttpd/lighttpd.conf

Folgende Zeile im Abschnitt server.modules hinzufügen:

  "mod_fastcgi",

Folgende Zeilen ans Ende der Datei einfügen:

  fastcgi.server = ( ".php" => (( 
                    "bin-path" => "/usr/bin/php-cgi",
                    "socket" => "/tmp/php.sock" 
                )))

Und die Zeile

  server.document-root        = "/var/www"

durch 

  server.document-root        = "/var/www/infoscreen"

ersetzen.

=== Installation der Infoscreen Software ===
Folgende Zeilen ausführen:

  sudo -u www-data -i git clone https://github.com/raumzeitlabor/infoscreen.git /var/www/infoscreen
  sudo -u www-data -i cd /var/www/infoscreen && git submodule update --init --recursive


=== Update Repository bei Restart ===
  sudo /etc/local.rc

Folgende Zeile am Ende einfügen:

  cd /var/www/infoscreen && sudo -u www-data git pull

=== Autostart in X11 ===

  sudo nano /etc/rc.local

Folgende Zeile ganz am Ende einfügen:

  su -l pi -c startx

=== Autostart Chromium Kiosk ===

  sudo nano /etc/xdg/lxsession/LXDE/autostart

xscreensaver und lxpanel entfernen. Folgende Zeilen ergänzen: 

  @xset s off
  @xset -dpms
  @xset s noblank
  @chromium --user-data-dir=/tmp --kiosk cosm.tiefpunkt.com/infoscreen/
  @xmodmap -e "pointer = 1 10 9 8 7 6 5 4 3 2"

=== Entferne Desktop-Icons ===
Die Desktop-Icons stören nur, man hat ja keine Maus um sie wegzuklicken. Weg damit:

  rm ~pi/Desktop/*.desktop

=== Ändern des Boot-Screens ===
Wenn der InfoScreen startet, soll ein hübsches Bild angezeigt werden, welches unter /etc/splash.png liegt. Die aktuelle Version habe ich [https://wiki.raumzeitlabor.de/wiki/Datei:Splash.png hier verlinkt]. Dafür installierien wir uns zuerst fbi:

  apt-get install fbi

Dann erstellen wir die Datei /etc/init.d/asplashscreen mit folgendem Inhalt:

  #! /bin/sh
  ### BEGIN INIT INFO
  # Provides:          asplashscreen
  # Required-Start:
  # Required-Stop:
  # Should-Start:      
  # Default-Start:     S
  # Default-Stop:
  # Short-Description: Show custom splashscreen
  # Description:       Show custom splashscreen
  ### END INIT INFO
  
  do_start () {
  
      /usr/bin/fbi -T 1 -noverbose -a /etc/splash.png    
      exit 0
  }
  
  case "$1" in
    start|"")
      do_start
      ;;
    restart|reload|force-reload)
      echo "Error: argument '$1' not supported" >&2
      exit 3
      ;;
    stop)
      # No-op
      ;;
    status)
      exit 0
      ;;
    *)
      echo "Usage: asplashscreen [start|stop]" >&2
      exit 3
      ;;
  esac

Nun machen wir die Datei ausführbar und nehmen sie in den Startprozess mit auf:
  chmod a+x /etc/init.d/asplashscreen
  insserv /etc/init.d/asplashscreen

(Anleitung via [http://www.recantha.co.uk/blog/?p=799]. Danke!)

=== Ändern des Desktophintergrunds ===
Nachdem wir so ein tolles Bootlogo haben und auch alle Desktopicons versteckt sind, können wir auch den Desktophintergrund auf unser Bootlogo ändern. In der Datei 
  ~pi/.config/pcmanfm/LXDE/pcmanfm.conf
gibt es folgenden Wert:
  wallpaper=/etc/alternatives/desktop-background

Dies ersetzen wir durch
  wallpaper=/etc/splash.png

Fertig. Nun wird beim Bootvorgang ausschließlich das RZL-Logo zu sehen sein!

[[Kategorie:Projekt]]
[[Kategorie:Hardware]]
